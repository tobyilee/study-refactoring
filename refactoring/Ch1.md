# 1장 리팩터링: 첫 번째 예시

## 코틀린으로 예제 작성

- 책의 json을 적절한 data class로 변환하는 작업이 필요
- Kotlin의 serialization 라이브러리를 사용하여 json을 data class로 변환
- 테스트를 이용해서 statement()가 리턴하는 인보이스 텍스트를 비교해서 검증하는 코드 추가해서 코를틴 예제가 문제 없는지 확인

> ⚠️ WARNING 
> 
> GitHub Copilot이 책 예제를 코틀린으로도 너무 잘 만들어 줌. 
> Kotlin으로 작성된 예제를 알고 있는 것인가.
> 
> 리팩터링 연습할 때는 Copilot은 끄고 하는게 좋을 듯

하나의 함수로 예제를 시작해서 중첩 함수를 중첩해서 이후 개선을 해나가는 작업은 단일 함수로 기능을 제공하는 스크립트 계열 언어에 잘 어울린다. 
코틀린은 탑 레벨 함수로 비슷하게 접근할 수 있고, 로컬 함수를 지원하기 때문에 유사하게 접근할 수 있지만, 자바와 같은 메소드를 중첩하는 것이 허용되지 않는 
경우엔 어떤 선택을 해야할까. 

혹은 코틀린을 쓴다고 하더라도 클래스 기반으로 접근한다면 다른 스타일의 응집도가 높은 코드로 만들 수도 있겠다. 

테스트를 준비하고, 아주 작은 스텝으로 리팩터링을 진행한다. 
리듬이 느껴지는게 필요하다. 테스트 없이는 할 수 없는 작업이다.
1장 예제는 46개의 커밋으로 만들어졌다. 

초기엔 코드에 코드에 구조를 적용하면서 더 이해하기 쉬운 코드로 만들고, 이후 리팩터링이 쉽게 될 수 있도록
다양한 로컬 변수를 제거하고 추출된 함수 내부에서만 사용되도록 만들었다.

성능상 다소 손해처럼 보이는 반복 호출 등을 초반엔 신경쓸 필요가 없다.
Split Loop, Slide Statement 등으로 관련된 코드를 모으는 작업이 필요하다. 

구조가 드러나면 이를 기반으로 본격적인 리팩터링을 진행한다.

추가될 기능을 생각하면서 전체 코드를 변경 이유와 기능에 따라 크게 분리하는 작업이 필요하다.

Swith 같은 전형적인 Condition을 다형성으로 적용하는 것이 필요한데, 예제에서 보여준 것처럼 이를 아주 작은 스텝으로 쪼개서 하는 습관을 가지면 좋겠다. 

MF처럼 몇 가지 코딩 표준, 관례를 잡아두면 좋겠다. 함수의 결과로 리턴하는 값을 계산하는 변수 이름은 항상 result라든가.

